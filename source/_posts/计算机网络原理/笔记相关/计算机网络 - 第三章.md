---
title: 计算机网络原理 - 第三章
description: 计算机网络原理 - 第三章 传输层
katex: true
categories: 自考
tags:
  - 自考
  - 计算机网络原理
cover: 'https://ae01.alicdn.com/kf/Uc2ab53b039fb4dc8b1408aa5ff85407eN.jpg'
hidden: true
abbrlink: 537d2c2a
date: 2020-03-02 12:03:01
---

# 第三章 传输层

## 第一节 传输层的基本服务

### 一、 传输层的功能

传输层的**核心任务**是：为**应用进程**之间提供端到端的逻辑通信服务。

功能：

- <u>传输层寻址</u>
- 对应用层报文进行<u>分段和重组</u>
- 对<u>报文进行差错检测</u>
- 实现进程间<u>端到端</u>可靠数据传输控制
- 面向应用层实现<u>复用与分解</u>
- 实现端到端的<u>流量控制</u>
- <u>拥塞控制</u>等

### 二、 传输寻址与端口

![](https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile1/imgbed/2020/03/02/20200302120003.png)

### 三、 无连接服务与面向连接服务

Internet 网络提供无连接服务的传输层协议是 UDP，提供面向连接服务的传输层协议是TCP。

- 面向链接服务
  
  面向连接服务：发送方和接收方在进行信息传输时，需要先建立传输链路，然后才能进行信息传输，信息传输完毕后再拆除该传输链路。

- 无连接服务
  
  无连接服务：不经过面向连接服务的“建立传输链路”、“拆除传输链路”，直接进行数据传输。

## 第二节 传输层的复用与分解

多路复用与多路分解:是传输层的一项基本功能,支持众多应用进程**共用同一个**传输层协议,并能够将接收到的数据准确交付给不同的应用进程。

1. 定义：支持众多应用进程共用同一个传输层协议，并能够将接收到的数据准确交付给不同的应用进程。

2. 实现的关键：传输层协议能够唯一标识一个套接字

3. 无连接与面向连接
   
   - 无连接的多路复用与多路分解
     
     1. 无连接
        
        提供协议：`UDP`
        
        唯一标识：`<目的 IP 地址，目的端口号>`
     
     2. 面向连接
        
        提供协议：`TCP`
        
        唯一标识：`<源 IP 地址，目的 IP 地址，源端口号，目的端口号>`
        
        其中：<u>源端口号</u>和<u>目的端口</u>号是TCP<u>报文段首部字段</u>，而源地址和目的地址是封装TCP报文段的IP数据段的首部字段。

4. 为UDP套接字分配端口号有两种方法
   
   - 创建一个UDP套接字时，传输层自动地为该套接字分配一个端口号，该端口号当前未被该主机中任何其他UDP套接字使用
   - 在创建一个UDP套接字后，通过调用bind()函数为该套接字绑定一个特定的端口号。

## 第三节 停-等协议与滑动窗口协议

### 一、 可靠数据传输基本原理

1. （可能发生的问题）不可靠传输信道在数据传输中可能发生
   - 比特差错
   - 乱序
   - 数据丢失
2. （实现方案）实现可靠数据传输措施
   - 差错检测（利用差错编码实现数据包传输过程中的比特差错检测）
   - 确认（接受方向发送方反馈接受状态）
     - ACK（肯定确认）
     - NAK（否定确认）
   - 重传（发送方重新发送接受方没有正确接受的数据）
   - 序号（确保数据按序提交）
   - 计时器（解决数据丢失问题）

### 二、停等协议

停等协议的主要特点就是每发送一个报文段后就停下来等待接收方的确认。

**此协议存在性能问题：降低了信道利用率**

基本工作过程：

> 1. 发送并等待确认
> 2. 接受并确认/否认
> 3. 继续发送/重发

1. 发送方发送经过差错编码和编号的报文段，等待接收方的确认
2. 接收方如果正确接收报文段，即差错检测无误且序号正确，则接收报文段，并向发送方发送 ACK
3. 否则丢弃报文段，并向发送方发送 NAK
4. 发送方如果收到 ACK，则继续发送后续报文段，否则重发刚刚发送的报文段。

停等协议信道利用率：$U_{sender} = \frac{t_{Seg}}{t_{Seg}+RTT+t_{ACK}}$

这种重传机制的可靠数据传输协议称为<u>自动重传请求（ARQ）协议</u>，最简单的ARQ协议就是停-等协议。

### 三、 滑动窗口协议（典型流水线协议）

在滑动窗口中发送窗口与接收窗口都等于1

滑动窗口协议实质上就是将可靠数据传输的工作过程，抽象到分组序号空间，即发送方确保分组按序发送，接收方确保分组按序提交。

两种最具代表性的滑动窗口协议是：

- GBN 协议（发送窗口≥1，接收窗口=1）
- SR 协议（发送窗口和接收窗口都大于1）

滑动窗口协议信道利用率：$U_{Sender} = \frac{t_{Seg}}{t_{sSeg}+RTT+t_{ACK}}$

## 第四节 用户数据报协议（UDP）

用户数据报协议 UDP 是 Internet 传输层协议，提供<u>无连接、不可靠、数据报尽力</u>传输服务。

相比于TCP的优点有：

- 应用进程更容易控制发送什么数据以及何时发送，节省时间。
- 无需建立连接，传输数据前不必建立连接，节省时间。
- 无连接状态，因不必建立链接，所以不必维护该连接欸链路，故开销小。
- 首部开销小，相比首部开销至少有20字节的TCP报文段，UDP仅有8字节。

![](https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile1/imgbed/2020/03/02/20200302130144.png)

### UDP校验和

1. 提供了差错检测功能
2. 计算内容包括：
   - `UDP`伪首部
   - `UDP`首部和应用层数据
3. 计算规则
   - 参与运算的内容按 16 位对齐求和。
   - 求和过程中遇到任何溢出（即进位）都被回卷（即进位与和的最低为再加），最后得到的和取反码。

## 第五节 传输控制协议（TCP）

TCP是Internet的一个<u>重要传输层协议</u>，提供<u>面向连接、可靠、有序、宇节流服务</u>。

TCP协议特点：

- 应用进程要先建立连接。
- 每一条 TCP 连接只有两个端点。
- 可靠交付。无差错，不丢失，不重复且按序到达。
- 全双工通信。
- 面向字节流。

其报文结构：

![](https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile1/imgbed/2020/03/02/20200302130720.png)

### TCP连接管理（三次握手、四次挥手）

简单概括的讲三次握手就是建立连接的过程。四次断开就是断开连接的过程。

| 每次握手  | 内容                               |
|:-----:|:--------------------------------:|
| 第一次握手 | 主机 A 向主机 B 収送连接请求段。              |
| 第二次握手 | 主机 B 收到 TCP 连接请求段后，如同意，则发回确认报文段。 |
| 第三次握手 | （可携带数据）主机 A 对主机 B 的同意连接报文段进行确认。  |

| 每次挥手  |                      |
|:-----:|:--------------------:|
| 第一次挥手 | 主机 A 向主机 B 发送释放连接报文段 |
| 第二次挥手 | 主机 B 向主机 A 发送确认段     |
| 第三次挥手 | 主机 B 向主机 A 发送释放连接报文段 |
| 第四次挥手 | 主机 A 向主机 B 发送确认段     |

TCP 的序号是对每个应用层数据的每个字节进行编号。确认序号是期望从对方接收数据的字节序号，将已连续接收到的应用层数据的最后一个字节的序号加1，作为确认序号。

更多关于三次握手与四次断开的内容请点击👉[/posts/eaefe101/index.html](/posts/eaefe101/index.html)

### TCP可靠数据传输

TCP 的可靠数据传输实现机制包括<u>差错编码、确认、序号、重传、计时器</u>等。

TCP的可靠数据传输是基于滑动窗口协议，但是发送窗口大小动态变化。

TCP 可靠数据传输的工作机制：

1. 数据分割
2. 启动计时器
3. 校验和检测数据差错
4. 重新排序
5. 丢弃重复报文段
6. 提供流量控制

发送方的 3 个与发送和重传有关的主要事件：从上层应用程序接收数据、定时器超时、收到 ACK。

### TCP流量控制

流量控制（flow control）的目的是协调协议发<u>送方与接收方</u>的数据<u>发送与接收</u>速度，避免因发送方发送数据太快，超出接收方的数据接收和处理能力，导致接收方被数据“淹没”，即数据到达速度超出接收方的接收、缓存或处理能力，致使数据在接收方被丢弃。

### TCP拥塞控制

拥塞控制就是通过合理调度、规范、调整向网络中发送数据的主机数量、发送速率或数据量，以避免拥塞或尽快消除已发生的拥塞。TCP 的拥塞控制算法包括了慢启动、拥塞避免、快速重传和快速恢复。（CongWin 初值为 1，Threshold 的初值为 16MSS。）

| 拥塞控制算法 | 描述                                                    |
|:------:|:-----------------------------------------------------:|
| 慢启动    | 收到一个确认，CongWin 值就加倍，即指数增长的时间段。                        |
| 拥塞避免   | 每经过一个 RTT，拥塞窗口 CongWin 的值增加 1MSS，即线性增长的时间段。           |
| 快速重传   | 基本思想是接收端收到 3 次重复确认时，则推断被重复确认的报文段已经丢失，于是立即发送被重复确认的报文段。 |
| 快速恢复   | 是配合快速重传使用的算法，不再重新从慢启动阶段开始，而是从新的阈值开始，直接进入拥塞避免阶段。       |

> 快速恢复的具体做法是：
> 
> 当发送端连续收到 3 次重复确认时，将阈值 Threshold减半，并且将拥塞窗口 CongWin 的值置为减半后的 Threshold，然后开始执行拥塞免算法，使 CongWin 缓慢地加性增长。