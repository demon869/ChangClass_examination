---
title: 计算机网络原理 - 第四章
description: 计算机网络原理 - 第四章 网络层
katex: true
categories: 自考
tags:
  - 自考
  - 计算机网络原理
cover: 'https://ae01.alicdn.com/kf/Uc2ab53b039fb4dc8b1408aa5ff85407eN.jpg'
hidden: true
abbrlink: e450354f
date: 2020-03-05 18:33:01
---

# 第四章 网络层

## 第一节 网络层服务

网络层的主要作用是将网络层数据报从**源主机**送达**目的主机**

网络层的功能分为：<u>转发、路由</u>、连接建立。

- 转发

  当通过一条输入链路接收到一个分组后，路由器需要决策通过哪条输出链路将分组发送出去，并将分组从输入接口转移到输出接口。

- 路由

  当分组从源主机流向目的主机时，必须通过某种方式决定分组经过的路由或路径，计算分组所经过的路径的算法被称为路由选择算法，或称为路由算法。

- 连接建立（**分组交换网络**）

  - 仅在网络层提供连接的**虚电路网络**。
  - 仅在网络层提供无连接服务的**数据报网络**。

## 第二节  数据报网络与虚电路网络

1. 数据报网络

   按照目的<u>主机地址</u>进行<u>路由选择</u>的网络称为数据报网络，提供<u>无连接服务</u>。

2. 虚电路网络

   不需要为每条虚电路分配独享资源（区别于电路交换）
   
   根据虚电路号沿虚电路路径按序发送分组
   
   1、虚电路网络在网络层提供<u>面向连接</u>的<u>**分组交换服务**</u>。虚电路是在源主机到目的主机的一条路径上建立的一条网络层逻辑连接，称之为虚电路。
   2、一条虚电路由 3 个要素构成： 1）从源主机到目的主机之间的一条路径 2）该路径上的每条链路各有一个虚电路标识（VCID） 3）该路径上每台分组交换机的转发表中记录虚电路标识的接续关系
   3、虚电路分组交换有<u>永久型</u>和<u>交换型</u>两种。
   
   > （1）永久型虛电路（PVC）：是一种提前建立、长期使用的虚电路，虚电路的建立时间开销基本上可以忽略。
   > （2）交换型虛电路（SVC）：是根据通信需要而临时建立的虚电路，通信结束后立即拆除，虚电路的建立和拆除时间开销有时相对影响较大。
   
   4、虚电路交换与数据报交换主要差别表现为：是将顺序控制、差错控制和流量控制等功能交给网络来完成（虚电路），还是由端系统来完成（数据报）。

## 第三节  网络互连与网络互连设备

1. 异构网络互连

   异构网络主要是指两个网络的<u>通信技术和运行协议的不同</u>。实现异构网络互连基本策略主要包括<u>**协议转换**</u>和<u>**构建虚拟互联网络**</u>。而实现同构网络互连的典型技术则是<u>隧道技术</u>。
   在网络层实现网络互连的设备是**路由器**。**集线器**和**中继器**都是物理层设备。**交换机**和**网桥**是数据链路层设备，交换机就是多端口的网桥，是目前应用最广泛的数据链路层设备。

2. 路由器（<u>最典型的网络层设备</u>）

   从功能体系结构的角度可以将路由器分为<u>输入端口、交换结构、输出端口、与路由处理器</u>。

   路由处理器：转发与路由选择是路由器两项最重要的基本功能。
   
   ![](https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile1/imgbed/2020/03/05/20200305185115.png)
   
   > - 输入端口
   >
   >   负责从物理接口接收信号；还原数据链路层帧；提取数据报，根据数据报的目的P地址检索路由表；决策需要将该IP数据报交换到哪个输出端口。
   >
   > - 交换结构
   >
   >   实现将输入端口的I数据报交换到指定的输岀端口，主要基于三种交换结构：基于内存交换（性能最低也最便宜）、基于总线交换和基于网络交换（性能最好也最贵）
   >
   > - 输出端口
   >
   >   提供缓存排队功能，对将要发送的分组进行相应的封装，并通过物理端口发送出去。
   >
   > - 路由处理器
   >
   >   路由器的CPU，负责执行路由器的各种指令。



## 第四节 网络层拥塞控制

1. 拥塞的概念

   拥塞是一种持续的过载的网络状态，即用户对网络资源的总需求超过了网络固有容量。

2. 拥塞的原因

   - 缓冲区容量有限
   - 传输线路的带宽有限
   - 网络结点的处理能力有限
   - 网络中某些部分发生了故障

3. 拥塞控制的概念

   端系统或结点，采取某些措施来避免拥塞的发生，或者尽快消除已发生的拥塞。

4. 拥塞控制的措施

   - 流量感知路由

     将网络流量引导到不同的链路上，均衡网络负载，从避免拥塞发生

   - 准入控制

     审核新建虚电路，如果新虚电路会导致网络拥塞，那么网络拒绝建立该新虚电路。

     <u>是一种广泛应用于虛电路网络的拥塞控制技术</u>，若新建立的虚电路会导致网络变得拥塞，则网络会拒绝建立该虛电路。

   - 流量调节

     抑制分组：给拥塞数据报的**源主机**返回一个抑制分组

     背压：让抑制分组从拥塞节点到源节点的路径上的**每一跳**，都发挥抑制作用。
   
   - 负载脱落
   
     通过有选择地主动丢弃一些数据报，来减轻网络负载，从而缓解或消除拥塞。
     
     <u>是消除拥塞的另一个方法</u>，即通过有选择地主动丢弃一些数据报，来减轻网络负载，从而缓解或消除拥塞。当路由器中的数据报得不到及时处理，可能面临被丢弃的危险时，路由器就主动将该数据丢弃掉。

## 第五节 Internet网络层

Internet是目前世界上最大、最重要的计算机网络， Internet网络层主要包括网际协议（IP）、路由协议以及互联网控制报文协议（ICMP）

IP目前有两个版本：<u>IPv4和IPv6</u>，目前 Internet以IPv4为主。P是 Internet网络层<u>最核心的协议</u>。

### 一、IPv4协议

1. IP数据报格式

   ![](https://cdn.jsdelivr.net/gh/blogimg/HexoStaticFile1/imgbed/2020/03/05/20200305185512.png)

   - IP首部固定部分20字节
   - 标识：判断这些分片是否属于同一个IP数据报
   - 标志：判断是否为最后一个分片
   - 片偏移：判断各分片的先后顺序

   

2. IP数据报分片

   一个数据链路层协议帧所能承载的最大数据量称为该链路的最大传输单元（MTU）。
   最大分片可封装的数据长度（字节）为$d = \left [ \frac{M-20}{8} \right ] \times 8$ ; 需要的 IP 分片总数为$n = \left [ \frac{L-20}{d} \right ]$ ; 每个 IP 分片的片偏移字段取值为$F_{i} = \frac{d}{8} \times (i-1)$ ,1≪i≪n;每个 IP 分片的总长度字段为$L_{i} = \left \{  \right. _{L-d \times (n-1), i=1)}^{d + 20,i<<i<n}$ 每个 IP 分片的 MF 字段为$MF_{i} = \left \{  \right. _{0,i=n}^{1,1<<i<n}$


### 二、IPv4编址

1. IPv4 地址有 3 种常用的标记法：<u>二进制标记法、点分十进制标记法、十六进制标记法</u>。

2. IP 地址划分为两部分：前缀（网络部分）和后缀（主机部分）。定长前缀为分类地址，无类地址中网络地址前缀长度可变。

   分类地址划分：

   |  类  | 前缀长度 |                前缀                 |  首字节  |
   | :--: | :------: | :---------------------------------: | :------: |
   |  A   |   8位    |              0xxxxxxx               |  0～127  |
   |  B   |   16位   |          10xxxxxx xxxxxxxx          | 128～191 |
   |  C   |   24位   |     110xxxxx xxxxxxxx xxxxxxxx      | 192～223 |
   |  D   |  不可用  | 1110xxxx xxxxxxxx xxxxxxxx xxxxxxxx | 224～239 |
   |  E   |  不可用  | 1111xxxx xxxxxxxx xxxxxxxx xxxxxxxx | 240～255 |

   |             特殊地址              |      私有IP地址      |
   | :-------------------------------: | :------------------: |
   |     本地主机地址 `0.0.0.0/32`     |   A类 `10.0.0.0/8`   |
   | 有限广播地址 `255.255.255.255/32` | B类 `172.16.0.0/12`  |
   |      回送地址 `127.0.0.0/8`       | C类 `192.168.0.0/16` |

   无类地址：前缀变成0～32位的任 意 值 。 形 式 为 `a.b.c.d/x` 

   

3. 子网划分

   将较大的子网划分为多个较小的子网的过程。

   子网化就是指将一个较大的子网划分为多个较小子网的过程。超网化是指将具有较长前缀的相对较小的子网合并为一个具有稍短前缀的相对较大的子网。 超网化是子网化的逆过程。子网掩码用来定义一个子网的网络前缀长度，是一个 32 位数，取值规则是：对应网络前缀，全部为 1，其余全部为 0。准确描述一个子网有两种形式：CIDR 和子网地址加子网掩码。

   子网掩码延长1（r）位，变成255.255.255.254，该子网将被划分为两个（$2^{r}$）子网。

4. 路由聚合

   路由聚合是为了提高路由效率，减少路由表项数，尽可能将能够聚合在一起的子网聚合成一个大的子网。“下一跳地址”和“接口”相同，才能聚合。

### 三、 动态主机配置协议

动态主机配置协议 DHCP 工作过程是：

1、DHCP 服务器发现 

2、DHCP 服务器提供 

3、DHCP请求 

4、DHCP 确认



## 四、网络地址转换

NAT 工作原理：对于从内网出去，进入公共互联网的 IP 数据报，将其源 IP 地址替换为 NAT服务器拥有的合法的公共 IP 地址， 同时替换源端口号，并将替换关系记录到 NAT 转换表中；对于从公共互联网返回的 IP 数据报，依据其目的 IP 地址与目的端口号检索 NAT 转换表，并利用检索到的内部私有 IP 地址与对应的端口号替换目的 IP 地址和目的端口号，然后将 IP 数据报转发到内部网络。



## 五、ICMP

ICMP 包括 3 个字段：类型、代码和校验和。ICMP 差错报告报文有 5 种： 终点不可达、 源点抑制、 时间超时、 参数问题、 路由重定向。ICMP 询问报文： 回声（echo） 请求/应答、 时间戳请求/应答。

互联网控制报文协议（ICMP）的主要功能是进行主机或路由器间的网络层差错报告与网络探测，ICMP发送的报文可分为<u>差错报告报文</u>和<u>询问报文</u>。

## 六、IPv6

IPv6地址中<u>最多只能</u>使用一个`::`，不能出现第二个`::`

1. 数据报格式：

   （1）版本字段（4 位）；

   （2）流量类型字段（8 位）；

   （3）流标签字段（20 位）；

   （4）下一个首部字段（8 位）；

   （5）跳数限制字段（8 位）；

   （6）源 IP 地址（128 位）和目的 IP 地址字段（128 位）；

   （7）数据。

2. IPv6 地址：地址长度为 128 位。

   （1）**单播地址**（可以作为 IPv6 数据报的<u>源地址</u>和<u>目的地址</u>）

   （2）**组播地址**（只能用作 IPv6 数据报的目的地址，向一个组播地址发送 IP 数据报，该组播 地址标识的多播组每个成员都会收到一个该 IP 数据报的一个副本）。

   （3）**任播地址**（只能用作IPv6 数据报的目的地址，但当向一个任播地址发送 IP 数据报时，只有该任播地址标识的任播组的某个成员收到该 IP 数据报）。



## 第六节 路由算法与路由协议

| 类别               | 代表性算法                   | 基础                                                         |
| ------------------ | ---------------------------- | ------------------------------------------------------------ |
| 全局式路由选择算法 | 链路状态路由选择算法（动态） | 利用 Dijkstra 算法求最短路径的                               |
| 分布式路由选择算法 | 距离向量路由选择算法（动态） | 距离向量路由选择算法的基础是 Bellman-Ford 方程（简称 B-F 方程） |

**层次化路由选择**：实现大规模网络路由选择最有效的、最可行的解决方案。每个自治系统都存在网关路由器。层次化路由选择将大规模互联网的路由划分为两层：自治系统内路由选择和自治系统间路由选择。

Internet 路由选择协议（层次化路由选择）

- 自治系统内路由选择 
  - **RIP**
  - OSPF
- 自治系统间路由选择
  - BGP

## 说明

本篇文章使用的脑图原件下载👉<a style='color: #FFF;' href="https://www.lanzous.com/i9yw79g" class="button button-3d button-action button-pill">XX云下载</a>